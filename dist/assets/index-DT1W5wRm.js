import{_ as z}from"./ConnectionStatus-DVNXvNM_.js";import{_ as A,V as L,a as H,b as G}from"./VContainer-B2Q5malN.js";import{o as J,a as K,c as M,g as Q,b as W,r as i,u as Z,d as u,w as s,e as a,f as r,t as o,V as S,h as d,i as O,j as f,k as ee,F as te,l as ae,m as se,n as re,p as oe,q as m,s as ne}from"./index-DVKfSaEg.js";import{V as T}from"./VAlert-DcuIcmEA.js";import{V as _}from"./VChip-_0uLb9DI.js";import{V as le,a as ie}from"./VRow-CoHcy7LL.js";const ue="0.2.8",de={version:ue},ce={class:"d-flex flex-column flex-sm-row justify-space-between align-start align-sm-center mb-6 gap-3"},me={class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center ga-3"},pe={class:"text-body-2"},ve={key:1,class:"text-center py-16"},fe={class:"text-body-2"},ye={key:0,class:"text-caption text-secondary mt-2"},ge={key:3,class:"d-flex flex-column ga-4"},he={class:"text-h5 text-primary-high font-weight-bold"},_e={class:"text-body-2 text-secondary"},xe={class:"d-flex ga-2 flex-wrap"},be={class:"d-flex justify-space-between align-center mb-2"},we={class:"text-center mt-2"},Ce={class:"text-caption text-secondary"},Ve=60,Ue=70,ke=80,je={__name:"index",setup(Me){const{success:F,error:x}=Z(),R=de.version,b=i(!1),y=i(null),w=i(!0),n=i(null),D=i(""),l=i(null),g=i(null),h=i(!1);let C=null;const $=m(()=>{if(!l.value)return[];const e=[];return l.value.code&&e.push(`Code: ${l.value.code}`),l.value.status&&e.push(`Status: ${l.value.status}`),l.value.requestUrl&&e.push(`URL: ${l.value.requestUrl}`),e}),B=m(()=>{const e=g.value?.components?.[0];return e?`${e.name}: ${e.current_version} → ${e.latest_version}`:"A system update is available."}),E=m(()=>Math.round(Number(n.value?.cpu?.usage_percent??n.value?.cpu?.usage??0))),N=m(()=>Math.round(Number(n.value?.memory?.percent??n.value?.memory?.percent_used??0))),P=m(()=>Math.round(Number(n.value?.disk?.percent??n.value?.disk?.percent_used??0))),p=m(()=>Number(n.value?.temperature?.celsius??n.value?.temperature?.temp_c??0)),v=m(()=>p.value>=ke?{color:"error",alertType:"error",message:"Your CDO Vertex is running hot. Temperature is in the critical range; the system may throttle to prevent damage."}:p.value>=Ue?{color:"warning",alertType:"warning",message:"Your CDO Vertex is above the ideal 70°C. Ensure it is not in direct sunlight and the vent has room for airflow."}:p.value>=Ve?{color:"info",alertType:"info",message:"Your CDO Vertex is operating in normal temperatures under typical use."}:{color:"success",alertType:"success",message:"Your CDO Vertex is operating in normal temperatures."});function j(e){return e>=90?"error":e>=70?"warning":"success"}function I(e){return e>=95?"error":e>=85?"warning":"success"}function Y(e){const t=Number(e||0),c=Math.floor(t/86400),k=Math.floor(t%86400/3600),X=Math.floor(t%3600/60);return`${c}d ${k}h ${X}m`}async function V(){try{b.value=!0,y.value=null;const e=await Q();n.value=e.data,w.value=!0,D.value=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(e){y.value=e.message,l.value=e,w.value=!1,x("Failed to fetch dashboard data: "+e.message)}finally{b.value=!1}}async function U(){try{const e=await W(),t=e.data?.components||[];g.value=t.some(c=>c.update_available)?e.data:null}catch{g.value=null}}async function q(){try{h.value=!0;const t=(await ne()).data||{};if(t.started||t.success){const c=t.job_id?` (job ${t.job_id})`:"";F(`Update started${c}. Re-open dashboard after the device finishes updating.`)}else x(t.error||"Update command failed to start.");await U()}catch(e){x("Failed to apply update: "+e.message)}finally{h.value=!1}}return J(async()=>{await V(),await U(),C=setInterval(()=>{V(),U()},5e3)}),K(()=>{C&&clearInterval(C)}),(e,t)=>(u(),M(G,{class:"pa-4 pa-md-6",fluid:""},{default:s(()=>[a("div",ce,[t[0]||(t[0]=a("div",null,[a("h1",{class:"text-h4 text-md-h3 text-primary-high font-weight-bold mb-1"},"Dashboard"),a("p",{class:"text-body-2 text-secondary"},"At-a-glance device health")],-1)),r(z,{connected:w.value},null,8,["connected"])]),g.value?.components?.length?(u(),M(T,{key:0,class:"mb-4",color:"warning",icon:"mdi-update",type:"warning",variant:"tonal"},{default:s(()=>[a("div",me,[a("div",null,[t[1]||(t[1]=a("div",{class:"text-subtitle-1 font-weight-bold"},"Update available",-1)),a("div",pe,o(B.value),1)]),r(S,{color:"warning",disabled:h.value,loading:h.value,"prepend-icon":"mdi-download",onClick:q},{default:s(()=>[...t[2]||(t[2]=[d("Update now",-1)])]),_:1},8,["disabled","loading"])])]),_:1})):O("",!0),b.value&&!n.value?(u(),f("div",ve,[r(ee,{color:"primary",indeterminate:"",size:"64"}),t[3]||(t[3]=a("div",{class:"text-body-1 text-secondary mt-4"},"Loading dashboard...",-1))])):y.value?(u(),M(T,{key:2,class:"mb-6",icon:"mdi-alert-circle",prominent:"",type:"error",variant:"tonal"},{append:s(()=>[r(S,{color:"error",variant:"outlined",onClick:V},{default:s(()=>[...t[4]||(t[4]=[d("Retry",-1)])]),_:1})]),default:s(()=>[t[5]||(t[5]=a("div",{class:"text-h6 mb-2"},"Connection Error",-1)),a("div",fe,o(y.value),1),$.value.length>0?(u(),f("div",ye,[(u(!0),f(te,null,ae($.value,(c,k)=>(u(),f("div",{key:k},o(c),1))),128))])):O("",!0)]),_:1})):(u(),f("div",ge,[r(A,{elevated:""},{default:s(()=>[r(L,{class:"d-flex flex-column flex-md-row justify-space-between align-start align-md-center ga-4"},{default:s(()=>[a("div",null,[t[6]||(t[6]=a("div",{class:"text-overline text-secondary"},"Device summary",-1)),a("div",he,o(n.value?.hostname?.hostname||"CDO Vertex"),1),a("div",_e," Uptime "+o(Y(n.value?.uptime?.uptime_seconds||0))+" · Dashboard v"+o(se(R)),1)]),a("div",xe,[r(_,{color:j(E.value),"prepend-icon":"mdi-chip",variant:"tonal"},{default:s(()=>[d(o(E.value)+"% CPU",1)]),_:1},8,["color"]),r(_,{color:I(N.value),"prepend-icon":"mdi-memory",variant:"tonal"},{default:s(()=>[d(o(N.value)+"% Memory",1)]),_:1},8,["color"]),r(_,{color:j(P.value),"prepend-icon":"mdi-harddisk",variant:"tonal"},{default:s(()=>[d(o(P.value)+"% Disk",1)]),_:1},8,["color"]),r(_,{color:v.value.color,"prepend-icon":"mdi-thermometer",variant:"tonal"},{default:s(()=>[d(o(p.value.toFixed(1))+"°C",1)]),_:1},8,["color"])])]),_:1})]),_:1}),r(le,null,{default:s(()=>[r(ie,{cols:"12",lg:"12",md:"12"},{default:s(()=>[r(A,{class:"h-100 hoverable-card"},{default:s(()=>[r(H,{class:"text-primary-high"},{default:s(()=>[...t[7]||(t[7]=[d("Temperature",-1)])]),_:1}),r(L,null,{default:s(()=>[a("div",be,[t[8]||(t[8]=a("span",{class:"text-body-2 text-secondary"},"CPU Temperature",-1)),a("span",{class:re(["text-h5",`text-${v.value.color}`])},o(p.value.toFixed(1))+"°C",3)]),r(oe,{color:v.value.color,height:"12","model-value":Math.min(Math.max(p.value,0),100),rounded:""},null,8,["color","model-value"]),r(T,{class:"mt-3",density:"comfortable",type:v.value.alertType,variant:"tonal"},{default:s(()=>[d(o(v.value.message),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})]),_:1}),a("div",we,[a("div",Ce,"Last updated: "+o(D.value),1)])]))]),_:1}))}};export{je as default};
